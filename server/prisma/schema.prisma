generator client {
  provider     = "prisma-client-js"
  output       = "../src/generated/prisma"
  moduleFormat = "cjs"
}

datasource db {
  provider = "postgresql"
}

model comment_reports {
  cid       Int
  uid       Int
  createdAt DateTime @default(now()) @db.Timestamp(6)

  comments comments @relation(fields: [cid], references: [cid], onDelete: Cascade, onUpdate: NoAction)
  users    users    @relation(fields: [uid], references: [uid], onDelete: Cascade, onUpdate: NoAction)

  @@id([cid, uid])
  @@index([cid], map: "idx_comment_reports_cid")
  @@index([uid], map: "idx_comment_reports_uid")
}

model comments {
  cid          Int       @id @default(autoincrement())
  iid          Int?
  uid          Int?
  comment_text String
  report_count Int?      @default(0)
  date_added   DateTime? @default(now()) @db.Timestamp(6)
  items        items?    @relation(fields: [iid], references: [iid], onDelete: Cascade, onUpdate: NoAction)
  users        users?    @relation(fields: [uid], references: [uid], onDelete: Cascade, onUpdate: NoAction)

  comment_reports comment_reports[]

  @@index([iid], map: "idx_comments_iid")
}

model images {
  imid        Int       @id @default(autoincrement())
  iid         Int?
  image_url   String
  uploaded_at DateTime? @default(now()) @db.Timestamp(6)
  items       items?    @relation(fields: [iid], references: [iid], onDelete: Cascade, onUpdate: NoAction)
}

model item_tags {
  iid   Int
  tid   Int
  items items @relation(fields: [iid], references: [iid], onDelete: Cascade, onUpdate: NoAction)
  tags  tags  @relation(fields: [tid], references: [tid], onDelete: Cascade, onUpdate: NoAction)

  @@id([iid, tid])
  @@index([iid], map: "idx_item_tags_iid")
  @@index([tid], map: "idx_item_tags_tid")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model items {
  iid         Int         @id @default(autoincrement())
  uid         Int?
  type        String
  title       String
  description String
  latitude    Decimal     @db.Decimal(9, 6)
  longitude   Decimal     @db.Decimal(9, 6)
  add_date    DateTime?   @default(now()) @db.Timestamp(6)
  comments    comments[]
  images      images[]
  item_tags   item_tags[]
  users       users?      @relation(fields: [uid], references: [uid], onDelete: Cascade, onUpdate: NoAction)

  @@index([add_date(sort: Desc)], map: "idx_items_add_date")
  @@index([latitude, longitude], map: "idx_items_lat_lng")
  @@index([type], map: "idx_items_type")
}

model otps {
  oid        Int      @id @default(autoincrement())
  email      String
  otp_code   String
  expires_at DateTime @db.Timestamp(6)

  // save password and username for later
  pending_username String
  pending_password String

  @@index([email], map: "idx_otps_email")
}

model tags {
  tid       Int         @id @default(autoincrement())
  tagname   String      @unique
  color     String?
  item_tags item_tags[]
}

model users {
  uid                Int        @id @default(autoincrement())
  email              String     @unique
  password           String
  username           String
  registeration_date DateTime?  @default(now()) @db.Timestamp(6)
  comments           comments[]
  items              items[]

  comment_reports comment_reports[]
}
